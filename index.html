<!DOCTYPE html>
<html>
  <head>
    <title>你还愿意吗</title>
  </head>
  <style>
  /*隐藏*/
    #inputname {
      display: none;
        }
    #points {
      display: none;
      width: 30%;
      height: 10%;
      margin: auto;
      position: fixed;
      bottom: 50%;
      left: 40%
        }  
    #gameText {
      display: none;
    }  
    
  /*输入名字*/
    .name-input{
      position: fixed;
      bottom: 50%;
      left: 50%
    }
    .nameinput_lable{
      position: fixed;
      bottom: 50%;
      left: 40%
    }
    .nameconfirm_button{
      position: fixed;
      bottom: 40%;
      left: 58%
    }

  /*读取按钮*/
    .start-game{
      position: fixed;
      top: 50%;
      right: 45%
    }
    .save-button{
      position: fixed;
      top: 10%;
      right: 15%
    }
    .load-button{
      position: fixed;
      top: 10%;
      right: 10%
    }

  /*文本*/
    .game_text{
      font-size: 25px;
      position: fixed;
      bottom: 50%;
      left: 50%
    }
  </style>
  <body>
  <!--容器-->
    <div id="game"></div>
    <div id="inputname">
      <label for="name-input" class="nameinput_lable">请输入你的名字:</label>
      <input type="text" id="name-input" class="name-input">
      <button id="name-confirm" class="nameconfirm_button">确定</button>
    </div>
    <div id="gameText"></div>
    <div id="points">
      <form>
        <label for="strength">力量：</label>
        <input type="number" id="strength" name="strength" min="0" max="15" value="0">
        <label for="agility">敏捷：</label>
        <input type="number" id="agility" name="agility" min="0" max="15" value="0">
        <label for="intelligence">智力：</label>
        <input type="number" id="intelligence" name="intelligence" min="0" max="15" value="0">
        <button type="submit">提交</button>
      </form>
      <p>总点数：<span id="totalPoints">0</span></p>
      <p>剩余点数：<span id="remainingPoints">0</span></p>  
    </div>
    
  <!--按钮-->
    <button id="start_game" class="start-game" onclick="startButton">开始旅程</button>
    <button id="save-button" class="save-button special-button">保存</button>
    <button id="load-button" class="load-button special-button">读取</button>
    
    
    <script>
      const gameContainer = document.getElementById("game");
      const inputNameContainer = document.getElementById("inputname");
     
      const nameInput = document.getElementById("name-input");
      
      const nameConfirmButton = document.getElementById("name-confirm");
      const startButton = document.getElementById("start-game");
      const saveButton = document.getElementById("save-button");
      const loadButton = document.getElementById("load-button");

    //存档
      let playerName = "";
      let gameState = {
        //playerName: "",
        text: "",
        currentTextIndex: 0,
      };

    //开始旅程按钮
      const start_game = document.getElementById("start_game");
      const inputNameElement = document.getElementById("inputname");

      start_game.addEventListener("click", function() {
       inputNameElement.style.display = "block";
       start_game.style.display = "none";
      });

    //文本内容
      const gameText = [
        `${playerName}，欢迎来到游戏世界！`,
        `这里充满了危险和冒险，但也有无数宝藏和机遇等待着你！`,
        `你的使命是探索这个世界，找到宝藏，并成为最伟大的冒险家！`,
      ];

      let currentTextIndex = 0;
      const gameTextElement = document.getElementById("gameText");

      function startGame() {
        gameTextElement.style.display = "block";
        gameState.text = `<span class="game_text"> ${playerName} ${gameText[currentTextIndex]}</span>`;
        render(); 
        document.addEventListener("click", function() {
          if (event.target.classList.contains("special-button")) {
            event.stopPropagation();
            return; 
          }
          if (currentTextIndex < gameText.length - 1) {
            currentTextIndex++;
            gameState.text = `<span class="game_text">${gameText[currentTextIndex]}</span>`;
          }
          render();
        });
      }
      
      function render() {
        const gameTextElement = document.getElementById("gameText");
        gameTextElement.innerHTML = gameState.text;
      }

    //输入名字
      const namecofirmButton = document.getElementById("name-confirm");
      const pointsElement = document.getElementById("points");
      nameConfirmButton.addEventListener("click", function () {
        playerName = nameInput.value;
        inputNameContainer.style.display = "none";
        pointsElement.style.display = "block";
      });

    //保存
      saveButton.addEventListener("click", function () {
        localStorage.setItem("gameState", JSON.stringify(gameState));
        console.log("游戏已保存");
      });

      loadButton.addEventListener("click", function () {
        const savedState = localStorage.getItem("gameState");
        inputNameContainer.style.display = "none";
        if (savedState) {
          gameState = JSON.parse(savedState);
          currentTextIndex = gameState.currentTextIndex;
          console.log("游戏已读取");
          render();
        } else {
          console.log("没有保存的游戏状态");
        }
      });

    //属性设置表单
    const form = document.querySelector('form');
		const totalPointsEl = document.querySelector('#totalPoints');
		const remainingPointsEl = document.querySelector('#remainingPoints');
		const maxPoints = 15;
		let totalPoints = maxPoints;
		let remainingPoints = 0;

		function updatePoints() {
			const strength = parseInt(document.querySelector('#strength').value);
			const agility = parseInt(document.querySelector('#agility').value);
			const intelligence = parseInt(document.querySelector('#intelligence').value);
			totalPoints = strength + agility + intelligence;
			remainingPoints = maxPoints - totalPoints;
			totalPointsEl.textContent = totalPoints;
			remainingPointsEl.textContent = remainingPoints;
		}

		form.addEventListener('input', updatePoints);
		form.addEventListener('submit', function(event) {
			event.preventDefault();
			if (remainingPoints < 0) {
				alert('属性点超出限制！');
				return;
			}
			alert(`力量：${document.querySelector('#strength').value}\n敏捷：${document.querySelector('#agility').value}\n智力：${document.querySelector('#intelligence').value}\n总点数：${totalPoints}`);
      pointsElement.style.display = "none"
      startGame()
    });
    </script>
  </body>
</html>
